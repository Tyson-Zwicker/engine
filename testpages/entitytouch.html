<!--
Test:
add/remove entities/parts
-->
<html>

<head>
    <script src=".././maths.js"></script>
    <script src=".././gfx.js"></script>
    <script src=".././main.js"></script>
    <script src=".././tattle.js"></script>
    <script src=".././button.js"></script>
    <script src=".././particle.js"></script>
    <script src=".././sprite.js"></script>
    <script src=".././part.js"></script>
    <script src=".././entitylabel.js"></script>
    <script src=".././entity.js"></script>
    <script src=".././entitymanager.js"></script>
    <script src=".././engine.js"></script>
    <script src="spritedefinitions.js"></script>
</head>

<body onload="_start(33,true)" style="border:none">
    <script>
        const engine = new Engine();
        //name,sprite, offset, orientation
        let fwdturret = new Part('fwdturret', turret, new Point(0, -100), 0);
        let aftturret = new Part('aftturret', turret, new Point(0, 100), rad(180));
        engine.addButton('testbutton1', 'add ent#2', 0, 180, 150, 210, 1.3, '#fff', '#600', '#007', '#fff', () => {
            engine.addEntity("entity2", [hull, superstructure], new Point(400, 0), 0, new Point(0, 0), 0, 10, 200, []);
        });
        engine.addButton('testbutton2', 'rmv ent#2', 0, 220, 150, 250, 1.3, '#fff', '#600', '#007', '#fff', () => {
            engine.removeEntity('entity2');
        });
        engine.addButton('testbutton3', 'add prt to ent2', 0, 260, 150, 290, 1.3, '#fff', '#600', '#007', '#fff', () => {
            engine.addEntityPart('entity2', aftturret);
        });
        engine.addButton('testbutton4', 'rem prt frm ent2', 0, 300, 150, 330, 1.3, '#fff', '#600', '#007', '#fff', () => {
            engine.removeEntityPart('entity2', 'aftturret');
        });

        engine.addTattler('1em monospace', 10, 300);
        //name, sprites, position, angle, velocity, spin, mass, radius, parts
        engine.addEntity(
            "entity1", [hull, superstructure], new Point(0, 0), 0, new Point(0, 0), 0, 10, 200, [fwdturret, aftturret]
        );
        engine.setEntityTouchEvent((entityName) => {
            if (entityName) {
                engine.tellTattleGrouped('touched', entityName, '#9ff');
            }
        });
        engine.setBackgroundTouchEvent (()=>{
            engine.tellTattleGrouped ('bground',`${_mouse.where.x},${mouse.where.y}`,'#aaa');
        });
        
        const program = {
            run: function () {
                //Main loop here.
                engine.tellTattleGrouped('zoom', _zoom, '#0ff');
                engine.tellTattleGrouped('key', _key.which, '#ff0');
                engine.tellTattleGrouped('mouse', _mouse.move.where, '#7f');
                engine.tellTattleGrouped('wheel', _mouse.wheel.where, '#0f0');
                engine.do();
            }
        };
    </script>
</body>

</html>